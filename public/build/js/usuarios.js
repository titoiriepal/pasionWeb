const usuariosPorPagina=25,BreakException="Usuarios máximos alcanzados";var paginaActual=1,muestraUsuarios=[],tablaUsuarios=[],paginas=0;async function iniciarUsuarios(){try{const a="http://localhost:33333/admin/api/usuarios",t=await fetch(a),o=await t.json();paginas=conseguirNumeroPaginas((tablaUsuarios=o).length),crearPaginacion(tablaUsuarios,paginaActual),iniciaBotonPaginacion(),ordenarNombre(tablaUsuarios),ordenarEmail(tablaUsuarios),ordenarAdmin(tablaUsuarios),ordenarBlog(tablaUsuarios),ordenarFoto(tablaUsuarios),ordenarRest(tablaUsuarios),busqueda()}catch(a){console.log(a)}}function crearMuestraUsuarios(a,t){muestraUsuarios=[];for(var o=t;o<t+25;o++)a[o]&&muestraUsuarios.push(a[o])}function ordenarNombre(a){document.querySelector("#tableNombre").addEventListener("click",()=>{crearPaginacion(tablaUsuarios=tablaUsuarios.sort(SortArrayNombre))})}function ordenarEmail(a){document.querySelector("#tableEmail").addEventListener("click",()=>{crearPaginacion(tablaUsuarios=tablaUsuarios.sort(SortArrayEmail))})}function ordenarAdmin(a){document.querySelector("#tableAdministrador").addEventListener("click",()=>{crearPaginacion(tablaUsuarios=tablaUsuarios.sort(SortArrayAdmin))})}function ordenarBlog(a){document.querySelector("#tableBloguero").addEventListener("click",()=>{crearPaginacion(tablaUsuarios=tablaUsuarios.sort(SortArrayBlog))})}function ordenarFoto(a){document.querySelector("#tableFoto").addEventListener("click",()=>{crearPaginacion(tablaUsuarios=tablaUsuarios.sort(SortArrayFoto))})}function ordenarRest(a){document.querySelector("#tableRest").addEventListener("click",()=>{crearPaginacion(tablaUsuarios=tablaUsuarios.sort(SortArrayRest))})}function busqueda(){const a=document.querySelector("#btnBusqueda"),t=document.querySelector("#busqueda");a.addEventListener("click",(function(){buscarUsuarios(t.value)}))}async function buscarUsuarios(a){const t=new FormData;t.append("cadena",a);try{const a="http://localhost:33333/admin/api/buscaUsuarios",o=await fetch(a,{method:"POST",body:t}),r=await o.json();paginas=conseguirNumeroPaginas((tablaUsuarios=r).length),crearPaginacion(tablaUsuarios,paginaActual)}catch(a){console.log(a)}}function crearPaginacion(a,t=1){document.querySelector("#numeroPagina").textContent=t,crearMuestraUsuarios(a,25*(t-1)??0),mostrarUsuarios(muestraUsuarios),paginaActual=t}function iniciaBotonPaginacion(){btnNext=document.querySelector("#btnNext"),btnNext.addEventListener("click",()=>{paginaActual<paginas&&crearPaginacion(tablaUsuarios,paginaActual+=1)}),btnPrev=document.querySelector("#btnPrev"),btnPrev.addEventListener("click",()=>{paginaActual>1&&crearPaginacion(tablaUsuarios,paginaActual-=1)})}function mostrarUsuarios(a){const t=document.querySelector("#cuerpoTabla");borrarTabla(),a.forEach(a=>{const{id:o,nombre:r,apellidos:e,email:n,admin:i,blog:s,fotografo:c,restringido:u,fechaCreacion:l,confirmado:d,token:m,password:b}=a,g=document.createElement("TR");g.dataset.idUsuario=o;const f=document.createElement("TD");f.textContent=r+" "+e;const p=document.createElement("TD");p.textContent=n;const U=document.createElement("TD");U.textContent="1"===i?"Si":"No";const h=document.createElement("TD");h.textContent="1"===s?"Si":"No";const S=document.createElement("TD");S.textContent="1"===c?"Si":"No";const y=document.createElement("TD");y.textContent="1"===u?"Si":"No";const E=document.createElement("TD"),A=document.createElement("A");A.classList.add("boton-rojo"),A.textContent="Eliminar",A.addEventListener("click",()=>{Swal.fire({title:"¿Estas seguro de eliminar este registro?",text:"Esta acción no se podrá deshacer",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Si, Borrar"}).then(t=>{if(t.isConfirmed){borrarUsuario(o);var r=tablaUsuarios.filter(t=>t.id!==a.id);console.log(r),tablaUsuarios=r,borrarTabla(),crearPaginacion(tablaUsuarios,1),Swal.fire("¡Registro Borrado!","El usuario ha sido eliminado correctamente.","success")}})});const C=document.createElement("A");C.setAttribute("href","usuarios/actualizar?id="+o),C.classList.add("boton-amarillo"),C.textContent="Actualizar",E.appendChild(A),E.appendChild(C),g.appendChild(f),g.appendChild(p),g.appendChild(U),g.appendChild(h),g.appendChild(S),g.appendChild(y),g.appendChild(E),t.appendChild(g)})}function borrarTabla(){document.querySelector("#cuerpoTabla").innerHTML=""}async function borrarUsuario(a){try{const t="http://localhost:33333/admin/usuarios/eliminar?id="+a,o=await fetch(t);await o.json()}catch(a){console.log(a)}}function SortArrayNombre(a,t){return a.nombre<t.nombre?-1:a.nombre>t.nombre?1:0}function SortArrayEmail(a,t){return a.email<t.email?-1:a.email>t.email?1:0}function SortArrayAdmin(a,t){return a.admin<t.admin?1:a.admin>t.admin?-1:0}function SortArrayBlog(a,t){return a.blog<t.blog?1:a.blog>t.blog?-1:0}function SortArrayFoto(a,t){return a.fotografo<t.fotografo?1:a.fotografo>t.fotografo?-1:0}function SortArrayRest(a,t){return a.restringido<t.restringido?1:a.restringido>t.restringido?-1:0}function conseguirNumeroPaginas(a){return paginas=a%25==0?a/25:parseInt(a/25,10)+1}document.addEventListener("DOMContentLoaded",(function(){iniciarUsuarios()}));