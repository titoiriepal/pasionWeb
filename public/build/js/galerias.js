const usuariosPorPagina=25,BreakException="Usuarios máximos alcanzados";var paginaActual=1,muestraUsuarios=[],tablaUsuarios=[],paginas=0;async function iniciarUsuarios(){try{const a=ruta+"/admin/api/usuariosNoFoto",o=await fetch(a),r=await o.json();paginas=conseguirNumeroPaginas((tablaUsuarios=r).length),crearPaginacion(tablaUsuarios,paginaActual),iniciaBotonPaginacion(),ordenarNombre(tablaUsuarios),busqueda()}catch(a){console.log(a)}}function crearMuestraUsuarios(a,o){muestraUsuarios=[];for(var r=o;r<o+25;r++)a[r]&&muestraUsuarios.push(a[r])}function ordenarNombre(a){document.querySelector("#tableNombre").addEventListener("click",()=>{crearPaginacion(tablaUsuarios=tablaUsuarios.sort(SortArrayNombre))})}function ordenarEmail(a){document.querySelector("#tableEmail").addEventListener("click",()=>{crearPaginacion(tablaUsuarios=tablaUsuarios.sort(SortArrayEmail))})}function ordenarAdmin(a){document.querySelector("#tableAdministrador").addEventListener("click",()=>{crearPaginacion(tablaUsuarios=tablaUsuarios.sort(SortArrayAdmin))})}function ordenarBlog(a){document.querySelector("#tableBloguero").addEventListener("click",()=>{crearPaginacion(tablaUsuarios=tablaUsuarios.sort(SortArrayBlog))})}function ordenarFoto(a){document.querySelector("#tableFoto").addEventListener("click",()=>{crearPaginacion(tablaUsuarios=tablaUsuarios.sort(SortArrayFoto))})}function ordenarRest(a){document.querySelector("#tableRest").addEventListener("click",()=>{crearPaginacion(tablaUsuarios=tablaUsuarios.sort(SortArrayRest))})}function busqueda(){const a=document.querySelector("#btnBusqueda"),o=document.querySelector("#busqueda");a.addEventListener("click",(function(){buscarUsuarios(o.value)}))}async function buscarUsuarios(a){const o=new FormData;o.append("cadena",a),console.log(o);try{const a="http://localhost:3000/admin/api/buscaUsuariosNoFoto",r=await fetch(a,{method:"POST",body:o}),t=await r.json();console.log(t),paginas=conseguirNumeroPaginas((tablaUsuarios=t).length),crearPaginacion(tablaUsuarios,paginaActual)}catch(a){console.log(a)}}function crearPaginacion(a,o=1){document.querySelector("#numeroPagina").textContent=o,crearMuestraUsuarios(a,25*(o-1)??0),mostrarUsuarios(muestraUsuarios),paginaActual=o}function iniciaBotonPaginacion(){btnNext=document.querySelector("#btnNext"),btnNext.addEventListener("click",()=>{paginaActual<paginas&&crearPaginacion(tablaUsuarios,paginaActual+=1)}),btnPrev=document.querySelector("#btnPrev"),btnPrev.addEventListener("click",()=>{paginaActual>1&&crearPaginacion(tablaUsuarios,paginaActual-=1)})}function mostrarUsuarios(a){const o=document.querySelector("#cuerpoTabla");borrarTabla(),a.forEach(a=>{const{id:r,nombre:t,apellidos:n,email:e,admin:i,blog:c,fotografo:s,restringido:u,fechaCreacion:l,confirmado:d,token:m,password:g}=a,b=document.createElement("TR");b.dataset.idUsuario=r;const f=document.createElement("TD");f.textContent=t+" "+n;const p=document.createElement("TD"),U=document.createElement("A");U.classList.add("boton"),idUsuario=r,U.textContent="Nueva Galeria",U.addEventListener("click",()=>{Swal.fire({title:"¿Quieres crear una nueva galería para este usuario?",text:"Esta acción no se podrá deshacer",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",cancelButtonText:"Cancelar",confirmButtonText:"Si, Crear"}).then(a=>{a.isConfirmed&&$((function(){$.post("http://localhost:3000/admin/galerias/crear",{id:idUsuario},(function(a,o){a&&location.reload()}))}))})}),p.appendChild(U),b.appendChild(f),b.appendChild(p),o.appendChild(b)})}function borrarTabla(){document.querySelector("#cuerpoTabla").innerHTML=""}async function borrarUsuario(a){try{const o="http://localhost:3000/admin/usuarios/eliminar?id="+a,r=await fetch(o);await r.json()}catch(a){console.log(a)}}async function crearGaleria(a){console.log("Id de Usuario "+a);const o=new FormData;o.append("id",a);try{console.log(o);const a="http://localhost:3000/admin/galerias/nueva",r=await fetch(a,{method:"POST",body:o});await r.json()}catch(a){console.log(a)}}function SortArrayNombre(a,o){return a.nombre<o.nombre?-1:a.nombre>o.nombre?1:0}function SortArrayEmail(a,o){return a.email<o.email?-1:a.email>o.email?1:0}function SortArrayAdmin(a,o){return a.admin<o.admin?1:a.admin>o.admin?-1:0}function SortArrayBlog(a,o){return a.blog<o.blog?1:a.blog>o.blog?-1:0}function SortArrayFoto(a,o){return a.fotografo<o.fotografo?1:a.fotografo>o.fotografo?-1:0}function SortArrayRest(a,o){return a.restringido<o.restringido?1:a.restringido>o.restringido?-1:0}function conseguirNumeroPaginas(a){return paginas=a%25==0?a/25:parseInt(a/25,10)+1}document.addEventListener("DOMContentLoaded",(function(){iniciarUsuarios()}));